<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project.meetu.model.dao.mapper.ConsultMapper">
	
	<!-- 특정 회원의 전체 상담목록 조회 -->
	<resultMap id="consultsResultMap" type="Consult">
		<id column="consult_id" jdbcType="INTEGER" property="id" javaType="int" />
		<result column="start_date" jdbcType="DATE" property="startDate" javaType="string" />
		<result column="end_date" jdbcType="DATE" property="endDate" javaType="string" />
		<result column="reason" jdbcType="VARCHAR" property="reason" javaType="string" />
		<result column="type" jdbcType="INTEGER" property="type" javaType="int" />
		<result column="state" jdbcType="INTEGER" property="state" javaType="int" />
		<result column="cancel_msg" jdbcType="VARCHAR" property="cancelMsg" javaType="string" />
		<association property="profUser" column="prof_id" javaType="ServiceUser">
			<id column="prof_id" jdbcType="VARCHAR" property="userId" javaType="string" />
			<association property="memberInfo" column="prof_no" javaType="Member">
				<id column="prof_no" jdbcType="VARCHAR" property="memberNo" javaType="string" />
				<result column="prof_name" jdbcType="VARCHAR" property="name" javaType="string" />
				<association property="profInfo" column="prof_no" javaType="Professor">
					<id column="prof_no" jdbcType="VARCHAR" property="memberNo" javaType="string" />
					<result column="office_no" jdbcType="VARCHAR" property="officeNo" javaType="string" />
				</association>
			</association>
		</association>
		<association property="stuUser" column="stu_id" javaType="ServiceUser">
			<id column="stu_id" jdbcType="VARCHAR" property="userId" javaType="string" />
			<association property="memberInfo" column="stu_no" javaType="Member">
				<id column="stu_no" jdbcType="VARCHAR" property="memberNo" javaType="string" />
				<result column="stu_name" jdbcType="VARCHAR" property="name" javaType="string" />
			</association>
		</association>
	</resultMap>
	
	<select id="selectConsultByUser" parameterType="String" resultMap="consultsResultMap">
		SELECT consult_id, start_date, end_date, reason, type, state, c.prof_id, c.stu_id, cancel_msg,
    		pm.member_no AS prof_no, pm.name AS prof_name,
    		p.office_no,
   		 	sm.member_no AS stu_no, sm.name AS stu_name 
		FROM consult c 
    		JOIN service_user pu ON c.prof_id = pu.user_id
    		JOIN member pm ON pu.member_no = pm.member_no
    		JOIN professor p ON pu.member_no = p.member_no 
			JOIN service_user su ON c.stu_id = su.user_id  
			JOIN member sm ON su.member_no = sm.member_no
		WHERE c.prof_id = #{userId} OR c.stu_id = #{userId}
	</select>
	
</mapper>